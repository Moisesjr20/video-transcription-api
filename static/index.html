<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcritor de Vídeos</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 0; }
        .container { max-width: 500px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 32px; }
        h1 { text-align: center; color: #333; }
        label { font-weight: bold; display: block; margin-bottom: 8px; }
        input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin-bottom: 16px; }
        button { width: 100%; padding: 12px; background: #007bff; color: #fff; border: none; border-radius: 4px; font-size: 1.1em; cursor: pointer; }
        button:disabled { background: #aaa; }
        .status, .error, .success { margin-top: 20px; padding: 12px; border-radius: 4px; }
        .status { background: #e9ecef; color: #333; }
        .error { background: #ffe0e0; color: #b00; }
        .success { background: #e0ffe0; color: #080; }
        .transcription { margin-top: 24px; background: #f4f4f4; padding: 16px; border-radius: 4px; white-space: pre-wrap; font-family: monospace; }
        .loader { display: inline-block; width: 18px; height: 18px; border: 3px solid #007bff; border-radius: 50%; border-top: 3px solid #fff; animation: spin 1s linear infinite; margin-right: 8px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>Transcritor de Vídeos</h1>
        <label for="drive-link">Cole o link do Google Drive:</label>
        <input type="text" id="drive-link" placeholder="https://drive.google.com/file/d/..." autocomplete="off">
        <button id="transcribe-btn">Transcrever</button>
        <div id="status" class="status" style="display:none;"></div>
        <div id="result" class="transcription" style="display:none;"></div>
    </div>
    <script>
        const btn = document.getElementById('transcribe-btn');
        const input = document.getElementById('drive-link');
        const statusDiv = document.getElementById('status');
        const resultDiv = document.getElementById('result');
        let currentTaskId = null;

        btn.onclick = async function() {
            const url = input.value.trim();
            if (!url) {
                showStatus('Por favor, cole o link do Google Drive.', 'error');
                return;
            }
            btn.disabled = true;
            showStatus('<span class="loader"></span>Enviando para transcrição...', 'status');
            resultDiv.style.display = 'none';
            resultDiv.textContent = '';
            try {
                const resp = await fetch('/transcribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ google_drive_url: url })
                });
                const data = await resp.json();
                if (!resp.ok) throw new Error(data.detail || 'Erro ao iniciar transcrição');
                currentTaskId = data.task_id;
                pollStatus(currentTaskId);
            } catch (e) {
                showStatus('Erro: ' + e.message, 'error');
                btn.disabled = false;
            }
        };

        async function pollStatus(taskId) {
            showStatus('<span class="loader"></span>Transcrevendo... Aguarde.', 'status');
            resultDiv.style.display = 'none';
            let finished = false;
            while (!finished) {
                await new Promise(r => setTimeout(r, 3000));
                try {
                    const resp = await fetch(`/status/${taskId}`);
                    const data = await resp.json();
                    if (data.status === 'sucesso') {
                        showStatus('Transcrição concluída!', 'success');
                        resultDiv.textContent = data.transcription || '[Sem texto]';
                        resultDiv.style.display = 'block';
                        btn.disabled = false;
                        finished = true;
                    } else if (data.status === 'erro') {
                        showStatus('Erro: ' + (data.message || 'Falha na transcrição.'), 'error');
                        btn.disabled = false;
                        finished = true;
                    } else {
                        showStatus(`<span class="loader"></span>${data.message || 'Processando...'}`, 'status');
                    }
                } catch (e) {
                    showStatus('Erro ao consultar status: ' + e.message, 'error');
                    btn.disabled = false;
                    finished = true;
                }
            }
        }

        function showStatus(msg, type) {
            statusDiv.innerHTML = msg;
            statusDiv.className = type;
            statusDiv.style.display = 'block';
        }
    </script>
</body>
</html> 